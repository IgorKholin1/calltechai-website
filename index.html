<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CallTechAI – Control Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet"/>
  <style>
    /* RESET */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      font-family: "Poppins", sans-serif;
      color: #fff;
      background: linear-gradient(135deg, #0a0f1f 0%, #131a3a 100%);
      overflow-x: hidden;
      scroll-behavior: smooth;
    }
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      background: rgba(10,15,31,0.8);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      position: sticky;
      top: 0; z-index: 1000;
    }
    .logo {
      font-size: 1.4rem; font-weight: 700; letter-spacing: 1px; text-transform: uppercase;
    }
    nav a {
      margin-left: 1.5rem; color: #fff; text-decoration: none; font-weight: 500;
      transition: color 0.3s;
    }
    nav a:hover { color: #a8dadc; }
    .container {
      width: 90%; max-width: 1000px;
      margin: 2rem auto;
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(8px);
      border-radius: 15px;
      padding: 2rem;
      box-shadow: 0 5px 10px rgba(0,0,0,0.3);
    }
    h2 { font-size: 1.6rem; margin-bottom: 1rem; font-weight: 700; text-align: center; }
    label { display: block; margin: 0.8rem 0 0.3rem; font-weight: 600; }
    input, select, textarea {
      width: 100%; padding: 0.6rem; border-radius: 5px; border: none;
      margin-bottom: 0.5rem; font-size: 1rem;
    }
    button {
      background-color: #415a77; color: #fff; border: none;
      padding: 0.8rem 1.5rem; border-radius: 50px; cursor: pointer;
      font-weight: 600; box-shadow: 0 3px 5px rgba(0,0,0,0.2);
      margin-top: 1rem; transition: background-color 0.3s;
    }
    button:hover { background-color: #778da9; }
    .auth-section, .dashboard-section, .scenario-section, .payment-section {
      margin-bottom: 2rem;
      display: none;
    }
    .show { display: block !important; }
    .scenario-steps {
      background: rgba(255,255,255,0.2);
      border-radius: 10px;
      padding: 1rem;
      margin-top: 1rem;
    }
    .step {
      display: flex; gap: 1rem; margin-bottom: 0.5rem;
    }
    .step input {
      width: 45%;
    }
    footer {
      text-align: center;
      padding: 1rem; margin-top: auto;
      background-color: rgba(0,0,0,0.2);
      font-size: 0.9rem;
    }
    footer a { color: #a8dadc; text-decoration: none; }
  </style>
</head>
<body>

<header>
  <div class="logo">CallTechAI</div>
  <nav>
    <a href="#" onclick="showSection('auth-section')">Auth</a>
    <a href="#" onclick="showSection('payment-section')">Payment</a>
    <a href="#" onclick="showSection('dashboard-section')">Dashboard</a>
  </nav>
</header>

<!-- AUTH SECTION -->
<div class="container auth-section" id="auth-section">
  <h2>User Authentication</h2>
  <div style="display:flex; gap:1rem; flex-wrap:wrap;">
    <!-- Login -->
    <div style="flex:1; min-width:300px;">
      <h3>Log In</h3>
      <label for="loginEmail">Email</label>
      <input type="email" id="loginEmail" placeholder="you@example.com"/>
      <label for="loginPassword">Password</label>
      <input type="password" id="loginPassword" placeholder="******"/>
      <button onclick="doLogin()">Log In</button>
      <p id="loginStatus" style="margin-top:0.5rem;"></p>
    </div>
    <!-- Sign Up -->
    <div style="flex:1; min-width:300px;">
      <h3>Sign Up</h3>
      <label for="signupEmail">Email</label>
      <input type="email" id="signupEmail" placeholder="you@example.com"/>
      <label for="signupPassword">Password</label>
      <input type="password" id="signupPassword" placeholder="******"/>
      <label for="signupPassword2">Confirm Password</label>
      <input type="password" id="signupPassword2" placeholder="******"/>
      <button onclick="doSignUp()">Sign Up</button>
      <p id="signupStatus" style="margin-top:0.5rem;"></p>
    </div>
  </div>
  <button style="background:#dc3545;" onclick="doLogout()">Log Out</button>
  <p id="logoutStatus" style="margin-top:0.5rem;"></p>
</div>

<!-- PAYMENT SECTION -->
<div class="container payment-section" id="payment-section">
  <h2>Choose Plan & Payment</h2>
  <div>
    <label>Select a Plan:</label>
    <select id="planSelect">
      <option value="basic">$99/mo – Basic</option>
      <option value="advanced">$199/mo – Advanced</option>
      <option value="premium">$399/mo – Premium</option>
    </select>
    <button onclick="checkoutPlan()">Proceed to Payment</button>
    <p id="paymentStatus" style="margin-top:1rem;"></p>
  </div>
</div>

<!-- DASHBOARD SECTION -->
<div class="container dashboard-section" id="dashboard-section">
  <h2>Dashboard</h2>
  <p>Welcome, <span id="userEmail"></span>!</p>
  <p>Your selected plan: <span id="userPlan"></span></p>

  <!-- Twilio Number Setup -->
  <h3>Phone Number Setup</h3>
  <p>Select or buy a Twilio number (demo):</p>
  <select id="twilioNumberSelect">
    <option value="">Choose number...</option>
    <option value="+14120001111">+1 (412) 000-1111</option>
    <option value="+14120002222">+1 (412) 000-2222</option>
  </select>
  <button onclick="assignNumber()">Assign Number</button>
  <p id="twilioStatus"></p>

  <!-- Scenario Setup -->
  <div class="scenario-section" id="scenarioSection" style="margin-top:2rem;">
    <h3>Scenario Setup</h3>
    <label>Bot Name</label>
    <input type="text" id="botName" placeholder="MyBot"/>

    <label>Greeting</label>
    <input type="text" id="botGreeting" placeholder="Hello! How can I help you?"/>

    <label>Fallback</label>
    <input type="text" id="botFallback" placeholder="Sorry, I didn't catch that." />

    <h4>Steps (User says → Bot replies)</h4>
    <div id="stepsContainer"></div>
    <button onclick="addStep()">+ Add Step</button>

    <button onclick="saveScenario()" style="margin-top:1rem;">Save Scenario</button>
    <p id="scenarioStatus" style="margin-top:0.5rem;"></p>
  </div>
</div>

<footer>
  <p>&copy; 2025 CallTechAI. All rights reserved. | <a href="#">Privacy Policy</a></p>
</footer>

<!-- Firebase & Panel Script -->
<script type="module">
  /***********************************************
   * 1) Firebase Imports & Init
   ***********************************************/
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-analytics.js";
  import {
    getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut,
    sendEmailVerification
  } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
  import {
    getFirestore, doc, setDoc, getDoc, updateDoc
  } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

  // Replace with your real config
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID",
    measurementId: "YOUR_MEASUREMENT_ID"
  };

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Global state
  let currentUser = null;
  let steps = []; // array of { userSay, botReply }

  /***********************************************
   * 2) onAuthStateChanged
   ***********************************************/
  onAuthStateChanged(auth, (user) => {
    if (user) {
      currentUser = user;
      console.log("Logged in as:", user.email);
      document.getElementById("userEmail").textContent = user.email;
      showSection("dashboard-section");
      loadUserPlan(); // load plan from Firestore
      loadScenario(); // load scenario from Firestore
    } else {
      currentUser = null;
      console.log("Not logged in");
      showSection("auth-section");
    }
  });

  /***********************************************
   * 3) Auth Functions
   ***********************************************/
  window.doSignUp = async function() {
    const email = document.getElementById("signupEmail").value;
    const pass = document.getElementById("signupPassword").value;
    const pass2 = document.getElementById("signupPassword2").value;
    const status = document.getElementById("signupStatus");
    status.textContent = "";

    if (!email || !pass || !pass2) {
      status.textContent = "Please fill all fields!";
      return;
    }
    if (pass !== pass2) {
      status.textContent = "Passwords do not match!";
      return;
    }

    try {
      const userCred = await createUserWithEmailAndPassword(auth, email, pass);
      await sendEmailVerification(userCred.user);
      status.textContent = "Registration successful! Check your email for verification.";
    } catch (err) {
      status.textContent = "Sign Up error: " + err.message;
    }
  };

  window.doLogin = async function() {
    const email = document.getElementById("loginEmail").value;
    const pass = document.getElementById("loginPassword").value;
    const status = document.getElementById("loginStatus");
    status.textContent = "";

    if (!email || !pass) {
      status.textContent = "Please fill all fields!";
      return;
    }

    try {
      await signInWithEmailAndPassword(auth, email, pass);
      status.textContent = "Login successful!";
    } catch (err) {
      status.textContent = "Login error: " + err.message;
    }
  };

  window.doLogout = async function() {
    await signOut(auth);
    document.getElementById("logoutStatus").textContent = "Logged out!";
  };

  /***********************************************
   * 4) Show/Hide sections
   ***********************************************/
  function showSection(sectionId) {
    // Hide all
    document.querySelectorAll(".auth-section, .dashboard-section, .payment-section")
      .forEach(el => el.style.display = "none");
    // Show needed
    document.getElementById(sectionId).style.display = "block";
  }

  /***********************************************
   * 5) Payment (Stripe Demo)
   ***********************************************/
  window.checkoutPlan = async function() {
    if (!currentUser) {
      alert("Please log in first!");
      return;
    }
    const plan = document.getElementById("planSelect").value;
    // Here you'd redirect to Stripe Checkout or Payment Link
    // We'll just emulate success
    document.getElementById("paymentStatus").textContent = "Payment successful! Plan: " + plan;
    // Save plan in Firestore
    await setDoc(doc(db, "users", currentUser.uid), { plan }, { merge: true });
    // Then go to dashboard
    showSection("dashboard-section");
    loadUserPlan();
  };

  async function loadUserPlan() {
    if (!currentUser) return;
    const docRef = doc(db, "users", currentUser.uid);
    const docSnap = await getDoc(docRef);
    let userPlan = docSnap.exists() && docSnap.data().plan ? docSnap.data().plan : "None";
    document.getElementById("userPlan").textContent = userPlan;
  }

  /***********************************************
   * 6) Twilio Number (Demo)
   ***********************************************/
  window.assignNumber = async function() {
    if (!currentUser) return alert("Not logged in!");
    const sel = document.getElementById("twilioNumberSelect");
    const number = sel.value;
    if (!number) return alert("Please select a number!");
    // Save number to Firestore
    await setDoc(doc(db, "users", currentUser.uid), { phoneNumber: number }, { merge: true });
    document.getElementById("twilioStatus").textContent = "Number assigned: " + number;
  };

  /***********************************************
   * 7) Scenario (Steps) logic
   ***********************************************/
  function updateStepsUI() {
    const stepsContainer = document.getElementById("stepsContainer");
    stepsContainer.innerHTML = "";
    steps.forEach((step, index) => {
      const div = document.createElement("div");
      div.className = "step";
      div.innerHTML = `
        <input type="text" placeholder="User says..." value="${step.userSay.replace(/"/g, '&quot;')}" oninput="steps[${index}].userSay=this.value"/>
        <input type="text" placeholder="Bot replies..." value="${step.botReply.replace(/"/g, '&quot;')}" oninput="steps[${index}].botReply=this.value"/>
        <button style="background:#dc3545;" onclick="removeStep(${index})">X</button>
      `;
      stepsContainer.appendChild(div);
    });
  }

  window.addStep = function() {
    steps.push({ userSay: "", botReply: "" });
    updateStepsUI();
  };
  window.removeStep = function(index) {
    steps.splice(index, 1);
    updateStepsUI();
  };

  /***********************************************
   * 8) Save/Load scenario from Firestore
   ***********************************************/
  async function loadScenario() {
    if (!currentUser) return;
    const docRef = doc(db, "users", currentUser.uid, "botData", "scenario");
    const snap = await getDoc(docRef);
    if (snap.exists()) {
      const data = snap.data();
      document.getElementById("botName").value = data.botName || "";
      document.getElementById("botGreeting").value = data.greeting || "";
      document.getElementById("botFallback").value = data.fallback || "";
      steps = data.steps || [];
      updateStepsUI();
    } else {
      steps = [];
      updateStepsUI();
    }
  }

  window.saveScenario = async function() {
    if (!currentUser) {
      alert("Not logged in!");
      return;
    }
    const scenarioData = {
      botName: document.getElementById("botName").value,
      greeting: document.getElementById("botGreeting").value,
      fallback: document.getElementById("botFallback").value,
      steps: steps,
      updatedAt: new Date().toISOString()
    };
    try {
      await setDoc(doc(db, "users", currentUser.uid, "botData", "scenario"), scenarioData);
      document.getElementById("scenarioStatus").textContent = "Scenario saved!";
    } catch (err) {
      document.getElementById("scenarioStatus").textContent = "Error saving scenario: " + err.message;
    }
  };

  /***********************************************
   * 9) Utility to show the correct section on load
   ***********************************************/
  document.addEventListener("DOMContentLoaded", () => {
    // By default, show auth if not logged in
    showSection("auth-section");
  });
</script>

</body>
</html>