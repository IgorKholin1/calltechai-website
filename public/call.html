<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Call Voice Bot</title>
  <script src="https://sdk.twilio.com/js/client/v1.13/twilio.min.js"></script>
</head>
<body>
  <h2>–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –ø–æ–∑–≤–æ–Ω–∏—Ç—å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É</h2>
  <button onclick="callBot()">üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å</button>

  <script>
    let device;

    async function callBot() {
      const response = await fetch('https://calltechai.onrender.com/token');
      const data = await response.json();

      device = new Twilio.Device(data.token, {
        codecPreferences: ['opus', 'pcmu'],
        fakeLocalDTMF: true,
        enableRingingState: true,
      });

      device.on('ready', () => {
        device.connect({ To: 'bot' });
      });

      device.on('error', error => {
        console.error('Twilio Error:', error);
      });
    }
  </script>
  <script src="https://sdk.twilio.com/js/client/v1.13/twilio.min.js"></script>
<script>
  async function makeCall() {
    try {
      const response = await fetch('/token'); // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω
      const data = await response.json();

      const device = new Twilio.Device(data.token, {
        codecPreferences: ['opus', 'pcmu'],
        debug: true
      });

      device.on('ready', () => {
        device.connect(); // —Å–æ–≤–µ—Ä—à–∞–µ–º –∑–≤–æ–Ω–æ–∫
      });

      device.on('error', (error) => {
        console.error('Twilio error:', error);
      });
    } catch (err) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ:', err);
    }
  }

  document.getElementById('callButton').addEventListener('click', makeCall);
</script>
</body>
</html>
